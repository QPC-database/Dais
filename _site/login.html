<!DOCTYPE html>
<html>
<head>
  <meta charset=utf-8 />
  <title>  Dais | Log in with Google |  Dais </title>
  <link rel="stylesheet" href="/Dais/css/bootstrap.min.css" />
</head>
<body> 
    <div class="navbar navbar-default">
  <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href=".">Dais</a>
  </div>
  <div class="navbar-collapse collapse navbar-responsive-collapse">
    <ul class="nav navbar-nav">
      <li class="active"><a href=".">Home</a></li>
      <li><a href="brainstorming.html">Brainstorming</a></li>
      <li><a href="needfinding.html">Needfinding</a></li>
      <li><a href="prototyping.html">Prototyping</a></li>
    </ul>
  </div>
</div>

  <div class="container-fluid">
 
    <link rel="stylesheet" type="text/css" href="demo/css/style.css">


<div id="signin-button" class="show">
     <div class="g-signin"
      data-callback="loginFinishedCallback"
      data-clientid="383055630084-416plvnvcs8aq79pq9lfssungfqh88k4.apps.googleusercontent.com"
      data-scope="https://www.googleapis.com/auth/plus.login https://www.googleapis.com/auth/plus.profile.emails.read"
      data-height="short"
      data-cookiepolicy="single_host_origin"
      >
    </div>
  </div>

  <div id="profile" class="hide">
    <div>
      <span id="pic"></span>
      <span id="name"></span>
    </div>
    <button type="button" class="btn btn-primary pull-right" id="disconnect" >Logout</button>

    <div id="email"></div>
    <button id="presentButton">View Presentations</button>
  </div>

<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script type="text/javascript">

  $(document).ready(function() {
    $('#disconnect').click(logout);
    $('#presentButton').click(showPresentations);
  });

  function showPresentations(){
    getPresentationsByUsername(username, function(presentations) { 
      var heatMapContainer = document.createElement("div");
      heatMapContainer.className = 'container-fluid';
      heatMapContainer.className = 'heatmap-container';
      document.body.appendChild(heatMapContainer);

      for(var i=0; i<presentations.length; i++){
       heatMapContainer.appendChild(presentations[i].displayHeatMap());
       // $(heatMapContainer.lastChild).addClass('col-sm-4');
      }
    });
  }

  /**
   * Global variables to hold the profile and email data.
   */
   var profile, email, username;

  /*
   * Triggered when the user accepts the sign in, cancels, or closes the
   * authorization dialog.
   */
  function loginFinishedCallback(authResult) {
    if (authResult) {
      if (authResult['error'] == undefined){
        toggleElement('signin-button'); // Hide the sign-in button after successfully signing in the user.
        gapi.client.load('plus','v1', loadProfile);  // Trigger request to get the email address.
      } else {
        console.log('An error occurred');
      }
    } else {
      console.log('Empty authResult');  // Something went wrong
    }
  }

  /**
   * Uses the JavaScript API to request the user's profile, which includes
   * their basic information. When the plus.profile.emails.read scope is
   * requested, the response will also include the user's primary email address
   * and any other email addresses that the user made public.
   */
  function loadProfile(){
    var request = gapi.client.plus.people.get( {'userId' : 'me'} );
    request.execute(loadProfileCallback);
  }

  /**
   * Callback for the asynchronous request to the people.get method. The profile
   * and email are set to global variables. Triggers the user's basic profile
   * to display when called.
   */
  function loadProfileCallback(obj) {
    profile = obj;

    // Filter the emails object to find the user's primary account, which might
    // not always be the first in the array. The filter() method supports IE9+.
    email = obj['emails'].filter(function(v) {
        return v.type === 'account'; // Filter out the primary email
    })[0].value; // get the email from the filtered results, should always be defined.

    var email_array = email.split('@');
    username = email_array[0];

    displayProfile(profile);
  }

  /**
   * Display the user's basic profile information from the profile object.
   */
  function displayProfile(profile){
    document.getElementById('name').innerHTML = profile['displayName'];
    document.getElementById('pic').innerHTML = '<img src="' + profile['image']['url'] + '" />';
    document.getElementById('email').innerHTML = email;
    toggleElement('profile');
  }

  /**
   * Utility function to show or hide elements by their IDs.
   */
  function toggleElement(id) {
    var el = document.getElementById(id);
    if (el.getAttribute('class') == 'hide') {
      el.setAttribute('class', 'show');
    } else {
      el.setAttribute('class', 'hide');
    }
  }

  /* Function to log out */

  function logout(){
    $.ajax({
        type: 'GET',
        url: 'https://accounts.google.com/o/oauth2/revoke?token=' +
            gapi.auth.getToken().access_token,
        async: false,
        contentType: 'application/json',
        dataType: 'jsonp',
        success: function(result) {
          console.log('revoke response: ' + result);
          toggleElement('profile');
          toggleElement('signin-button');
        },
        error: function(e) {
          console.log(e);
        }
    });
  }
  </script>
  <script src="https://apis.google.com/js/client:plusone.js" type="text/javascript"></script>
  <script type='text/javascript' src='https://cdn.firebase.com/js/client/1.0.11/firebase.js'></script>
  <script src='demo/js/Presentation.js' />

  <script type="text/javascript">
  // getAllPresentationsByUsername(username, print);

  function print(presentation){
    console.log(presentation);
  }
</script>
 
  </div>
</body>